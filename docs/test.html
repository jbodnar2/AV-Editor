<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="./favicon.ico" />
    <title>AV Editor</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/main.css" />
  </head>

  <body>
    <header>
      <div class="container">
        <h1>Home</h1>
      </div>
    </header>
    <nav>
      <div class="container">
        <ul>
          <li><a href="./">Home</a></li>
        </ul>
      </div>
    </nav>
    <main>
      <!-- Main content -->

      <style>
        .audio-captions {
          margin-block-start: 1rem;
          margin-inline: 1rem;
          padding: 1rem;
          box-shadow:
            0 0 6px rgba(0, 0, 0, 0.3),
            0 0 0 1px rgba(0, 0, 0, 0.1),
            0 1px 3px rgba(0, 0, 0, 0.3);
          max-height: 300px;
          overflow-y: scroll;

          .active {
            font-size: xx-large;
          }
        }
      </style>

      <video>
        <source src="media/audio-video/friday.mp4" type="video/mp4" />
        <track kind="captions" srclang="de" src="data/plane-de.vtt" />
        <track kind="captions" srclang="en" src="data/plane-en.vtt" />
      </video>
      <div class="audio-captions" id="captions"></div>

      <!-- Main content end -->
    </main>
    <footer></footer>

    <script>
      const mediaElement = document.querySelector("video");
      Object.assign(mediaElement, { controls: true });

      const textTracks = mediaElement.textTracks;
      const captionsElement = document.querySelector("#captions");
      const cues = new Map();

      textTracks.onchange = () => {
        for (const track of textTracks) {
          track.oncuechange = event => {
            const activeCue = event.target?.activeCues[0];
            const cueText = activeCue?.text;

            if (!cueText) return;

            const cueElement = cues.get(activeCue) ?? document.createElement("div");
            cueElement.textContent = cueText;
            cueElement.id = `cue-${activeCue.id}`;
            cueElement.className = "line";
            cues.set(activeCue, cueElement);

            captionsElement.prepend(cueElement);

            if (cueElement.nextElementSibling) {
              cueElement.nextElementSibling.classList.remove("active");
            }

            cueElement.classList.add("active");

            const firstChild = captionsElement.firstElementChild;
            if (firstChild && firstChild !== cueElement) {
              captionsElement.removeChild(firstChild);
            }

            cueElement.scrollIntoView({ behavior: "smooth", block: "end" });
          };
        }
      };
    </script>
  </body>
</html>
